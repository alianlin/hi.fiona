
<!DOCTYPE html>
<html>
<head>
  <title>圖片上傳 + 寫入 Sheets</title>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
</head>
<body>
  <button id="upload_widget">上傳圖片</button>
  <div id="result" style="margin-top: 20px;"></div>

  <script>
    const webhookUrl = 'https://script.google.com/macros/s/AKfycbymqafM78m0jy1TEvSOiRY3qoK1C1u1w7NRBoe6hrSQHC4ov5JLlU6oYb4irg6YxJJgZA/exec'; // ← ✨ 貼上剛剛部署的網址

    const myWidget = cloudinary.createUploadWidget({
      cloudName: 'ddhbsteya',    // ← 改成你的
      uploadPreset: 'hi.Fiona',        // ← 你的 unsigned preset
      folder: 'Hi.Fiona', // 可選，會存在 uploads 資料夾中
      multiple: false,   // 可改 true 讓使用者一次上傳多張
      maxFileSize: 2000000, // 限制檔案大小（單位 byte，例如 2MB）
    }, (error, result) => {
      if (!error && result && result.event === "success") {
        const imageUrl = result.info.secure_url;
        const uploaderName = '訪客'; // 可改成表單輸入者姓名
        
        // 顯示預覽
        document.getElementById('result').innerHTML = `
          ✅ 圖片上傳成功！<br>
          <img src="${imageUrl}" style="max-width:300px" />
          <br><small>${imageUrl}</small>
        `;

        // 寫入 Google Sheets
        fetch(webhookUrl, {
          method: 'POST',
          body: JSON.stringify({
            image_url: imageUrl,
            uploader_name: uploaderName
          }),
          headers: {
            'Content-Type': 'application/json'
          }
        }).then(res => res.json()).then(res => {
          console.log('寫入結果:', res);
        });
      }
    });

    document.getElementById("upload_widget").addEventListener("click", function () {
      myWidget.open();
    }, false);
  </script>
</body>
</html>